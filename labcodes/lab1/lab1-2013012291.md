# Lab 1

## ex1
### List of knowledge and concept
to be completed

### How ucore.img is generated?

- Compile kernel and bootloader respectively.
    There are a lot of options for the GCC compiler, and the meanings can be found at the end of this ex.
	With those options, the components are compiled to be suitable for IA32 platform, with GDB debugging infomation, and without unnecessary protections like the canary.
- Link the compiled components.
	By seperating compilation and linking when the source files are changed we don't have to remake the whole project.
	There are also many options for ld command, which also could be found at the end of the ex.
	The linking for the kernel uses a special script. The meaning of the script is detailed in the script file by comments. Frankly speaking I don't know much about the syntax of ld script. 
	The linking for the bootloader is simpler. The linker have to set 'start' in boot/bootasm.S as the entry of the program and its address have to be set to 0x7C00 for this is the address containing the 'second' instruction the CPU will carry out.
- Sign the bootblock
	Sign the bootblock using sign compiled from tools/sign.c.
	The effect is to set the last 2 bytes of the linked bootloader to be 'AA55'. This is necessary for a legal MBR.
- build the img
	Build img by dd command. To mimic a harddisk create an empty file with 10000 sectors first.
	Then copy bootblock and kernel into the file subsequently.

### What consists of a legal MBR
- 446 Bytes of bootstrap code.
- 64 Bytes of partition info.
- 2 Bytes of signature.

#### GCC options for compilation
- -I indicate the first dir in which to find headers.
- -fno-builtin do not use builtin functions (to prevent name collision).
- -Wall enable all warnings.
- -ggdb generate gdb debugging info.
- -m32 target machine is using 32bit CPU.
- -gstabs generate stabs debugging info.
- -nostdinc do not search header in standard dirs.
- -fno-stack-protector disable stack protector.
- -Os optimize as long as the size of the file does not increase.

#### ld options (GNU linker)
- -m emulate the indicated linker.
- -nostdlib do not search lib in std. Only search those indicated in the command line.
- -T specify a script file to control the linking process.
- -o indicate linking object.
- -N set text and data section to be readable and writable.
- -e explicitly set the entry point of the program.
- -Ttext locate specified address.
